<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chunk Translator</title>
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <main>
    <section class="panel">
      <div class="panel-header">
        <div class="title">
          <h1>Chunk Translator</h1>
          <div class="sub-row">
            <div class="sub">
              contact:
              <a class="link-underline" href="mailto:me@winterjung.dev">me@winterjung.dev</a>
              ·
              <a class="link-underline" href="https://github.com/winterjung/chunk-translator" target="_blank" rel="noopener noreferrer">github</a>
            </div>
            <details class="collapsible-details header-help-details" id="headerHelpDetails">
              <summary class="collapsible-summary">사용법</summary>
              <div class="header-help-card">
                <p>Chunk Translator는 긴 글을 작은 청크로 나눠 번역하고 다시 합쳐, 통번역 중 빠지는 문장이나 과한 요약을 줄이도록 만든 도구입니다.</p>
                <ol>
                  <li><strong>[0] 설정</strong>에서 Base URL, 모델, API Key를 입력합니다. ChatGPT를 구독 중이라면 <a class="link-underline" href="https://platform.openai.com/api-keys" target="_blank" rel="noopener noreferrer">OpenAI API Keys</a>에서 키를 발급받아 사용할 수 있습니다.</li>
                  <li><strong>[1] 원문</strong>에 글을 붙여넣고 <strong>청킹 생성</strong>을 눌러 문단 단위 작업을 준비합니다.</li>
                  <li>필요하면 <strong>[2] 요약</strong>에서 <strong>요약 생성</strong>을 눌러 전체 맥락을 만든 뒤, 각 청크 번역에 함께 사용합니다.</li>
                  <li><strong>[3] 청킹 · 번역</strong>에서 <strong>전체 번역 시작</strong>을 누르면 청크별로 병렬 번역됩니다.</li>
                  <li>어색한 부분은 해당 청크에 지시를 추가해 <strong>재번역</strong>하고, 완료 후 <strong>전체 번역 복사</strong>로 결과를 가져가면 됩니다.</li>
                </ol>
                <div class="header-help-note">이 도구는 서버 없이 동작하는 단일 HTML 페이지이며, API Key는 설정한 제공자(OpenAI, OpenRouter 등)로만 전송됩니다. 별도 analytics 도구는 사용하지 않습니다.</div>
              </div>
            </details>
          </div>
        </div>
      </div>
    </section>

    <section class="panel" id="settingsSection">
      <div class="section-title section-title-row">
        <span>[0] 설정</span>
        <button id="settingsToggle" class="btn-ghost btn-small" type="button" aria-expanded="true" aria-controls="settingsBody">접기</button>
      </div>
      <div id="settingsBody">
        <div class="grid-2">
          <div>
            <label class="label" for="baseUrl">Base URL</label>
            <input id="baseUrl" type="text" aria-label="Base URL" value="https://api.openai.com/v1" />
            <div class="preset-chips" id="baseUrlPresets" aria-label="Base URL 프리셋">
              <button type="button" class="chip" data-target="baseUrl" data-value="https://api.openai.com/v1">
                <span class="chip-title">OpenAI</span>
              </button>
              <button type="button" class="chip" data-target="baseUrl" data-value="https://api.anthropic.com" disabled>
                <span class="chip-title">Anthropic</span>
              </button>
              <button type="button" class="chip" data-target="baseUrl" data-value="https://generativelanguage.googleapis.com/v1beta/openai">
                <span class="chip-title">Gemini</span>
              </button>
              <button type="button" class="chip" data-target="baseUrl" data-value="https://openrouter.ai/api/v1">
                <span class="chip-title">OpenRouter</span>
              </button>
              <button type="button" class="chip" data-target="baseUrl" data-value="http://localhost:11434">
                <span class="chip-title">Ollama</span>
              </button>
              <button type="button" class="chip" data-target="baseUrl" data-value="http://localhost:1234/v1">
                <span class="chip-title">LM Studio</span>
              </button>
            </div>
          </div>
          <div>
            <label class="label" for="apiKey">API Key</label>
            <input id="apiKey" type="password" aria-label="API Key" placeholder="sk-..." />
            <div class="preset-chips" aria-label="API Key 테스트">
              <button id="connectionTestBtn" class="chip" type="button" aria-label="연결 테스트">연결 테스트</button>
            </div>
            <div class="log is-hidden" id="connectionTestLog" role="status" aria-live="polite"></div>
          </div>
        </div>
        <div style="margin-top: 8px;">
          <label class="label" for="targetLang">타깃 언어</label>
          <input id="targetLang" type="text" aria-label="타깃 언어" value="English" placeholder="예: English, Japanese" />
          <div class="preset-chips" id="targetLangPresets" aria-label="타깃 언어 프리셋">
            <button type="button" class="chip" data-target="targetLang" data-value="English">English</button>
            <button type="button" class="chip" data-target="targetLang" data-value="Korean">Korean</button>
            <button type="button" class="chip" data-target="targetLang" data-value="Japanese">Japanese</button>
          </div>
        </div>
        <details class="collapsible-details" id="modelSettingsDetails">
          <summary class="collapsible-summary"><span id="modelSettingsSummaryText">모델 설정 (요약: gpt-5.2 · 번역: gpt-5-mini)</span></summary>
          <div class="grid-2 price-wrapper">
            <div>
              <label class="label" for="summaryModel">요약 모델</label>
              <input id="summaryModel" type="text" aria-label="요약 모델" value="gpt-5.2" />
              <div class="preset-chips" id="summaryModelPresets" aria-label="요약 모델 프리셋">
                <button type="button" class="chip" data-target="summaryModel" data-value="gpt-5.2">gpt-5.2</button>
                <button type="button" class="chip" data-target="summaryModel" data-value="gpt-5-mini">gpt-5-mini</button>
                <button type="button" class="chip" data-target="summaryModel" data-value="claude-opus-4-6">claude-opus-4-6</button>
                <button type="button" class="chip" data-target="summaryModel" data-value="claude-sonnet-4-5">claude-sonnet-4-5</button>
                <button type="button" class="chip" data-target="summaryModel" data-value="gemini-3-pro">gemini-3-pro</button>
                <button type="button" class="chip" data-target="summaryModel" data-value="gemini-3-flash">gemini-3-flash</button>
              </div>
            </div>
            <div>
              <label class="label" for="translateModel">번역 모델</label>
              <input id="translateModel" type="text" aria-label="번역 모델" value="gpt-5-mini" />
              <div class="preset-chips" id="translateModelPresets" aria-label="번역 모델 프리셋">
                <button type="button" class="chip" data-target="translateModel" data-value="gpt-5-mini">gpt-5-mini</button>
                <button type="button" class="chip" data-target="translateModel" data-value="gpt-5-nano">gpt-5-nano</button>
                <button type="button" class="chip" data-target="translateModel" data-value="claude-haiku-4-5">claude-haiku-4-5</button>
                <button type="button" class="chip" data-target="translateModel" data-value="gemini-3-flash">gemini-3-flash</button>
                <button type="button" class="chip" data-target="translateModel" data-value="gemini-2.5-flash">gemini-2.5-flash</button>
                <button type="button" class="chip" data-target="translateModel" data-value="gemini-2.5-flash-lite">gemini-2.5-flash-lite</button>
              </div>
            </div>
          </div>
        </details>
        <details class="collapsible-details" id="pricingDetails">
          <summary class="collapsible-summary">모델 단가 ($/1M tokens)</summary>
          <div class="grid-2 price-wrapper">
            <div class="price-box">
              <div class="label">요약 모델 단가</div>
              <div class="price-grid">
                <label class="price-label" for="summaryPricePrompt">input</label>
                <input id="summaryPricePrompt" type="number" min="0" step="0.0001" placeholder="예: 1.50" aria-label="요약 prompt 단가" />
                <label class="price-label" for="summaryPriceCached">cached</label>
                <input id="summaryPriceCached" type="number" min="0" step="0.0001" placeholder="비워두면 prompt 단가" aria-label="요약 cached 단가" />
                <label class="price-label" for="summaryPriceCompletion">output</label>
                <input id="summaryPriceCompletion" type="number" min="0" step="0.0001" placeholder="예: 2.00" aria-label="요약 completion 단가" />
              </div>
            </div>
            <div class="price-box">
              <div class="label">번역 모델 단가</div>
              <div class="price-grid">
                <label class="price-label" for="translatePricePrompt">input</label>
                <input id="translatePricePrompt" type="number" min="0" step="0.0001" placeholder="예: 0.50" aria-label="번역 prompt 단가" />
                <label class="price-label" for="translatePriceCached">cached</label>
                <input id="translatePriceCached" type="number" min="0" step="0.0001" placeholder="비워두면 prompt 단가" aria-label="번역 cached 단가" />
                <label class="price-label" for="translatePriceCompletion">output</label>
                <input id="translatePriceCompletion" type="number" min="0" step="0.0001" placeholder="예: 1.00" aria-label="번역 completion 단가" />
              </div>
            </div>
          </div>
          <div class="help">모델 별 비용은 <a class="link-underline" href="https://models.dev" target="_blank" rel="noopener noreferrer">models.dev</a> 사이트를 참고하세요.</div>
        </details>
        <div class="log is-hidden" id="inputLog"></div>
      </div>
    </section>

    <section class="panel" id="sourceSection">
      <div class="section-title">[1] 원문</div>
      <div>
        <label class="label" for="sourceInput">원문 입력</label>
        <textarea id="sourceInput" aria-label="원문 입력" rows="10" placeholder="여기에 번역할 원문을 붙여넣기"></textarea>
        <div id="sourceCharCount" class="chunk-meta" aria-live="polite">길이: 0자</div>
      </div>
      <div class="actions">
        <button id="chunkBtn" class="btn-accent" aria-label="청킹 생성">÷ 청킹 생성</button>
        <button id="resetBtn" class="btn-ghost" aria-label="입력 내용 초기화">↺ 입력 초기화</button>
      </div>
    </section>

    <section class="panel" id="summarySection">
      <div class="section-title">[2] 요약 (Optional)</div>
      <div class="actions">
        <button id="summaryBtn" class="btn-accent" aria-label="요약 생성">▶ 요약 생성</button>
      </div>
      <div class="help">이 요약은 각 청크 번역 시 전체 맥락으로 사용됩니다.</div>
      <textarea id="summaryText" aria-label="요약 텍스트" rows="6" placeholder="요약 결과 (편집 가능)"></textarea>
      <div class="log is-hidden" id="summaryLog"></div>
    </section>

    <section class="panel" id="workSection">
      <div class="section-title">[3] 청킹 · 번역</div>
      <div class="actions">
        <div class="chunk-meta">총 <span id="chunkCount">0</span> 청크</div>
        <button id="translateBtn" class="btn-accent" aria-label="전체 번역 시작">▶ 전체 번역 시작</button>
        <button id="copyAllBtn" class="btn-accent" aria-label="전체 번역 복사">✓ 전체 번역 복사</button>
      </div>
      <div style="margin-top: 8px;">
        <label class="label" for="concurrencyRange">동시 요청</label>
        <div class="row">
          <input id="concurrencyRange" type="range" min="1" max="8" step="1" value="4" aria-label="동시 요청" />
          <div class="chunk-meta">현재 <span id="concurrencyValue">4</span>개</div>
        </div>
      </div>
      <div class="chunk-list" id="chunkList"></div>
      <div class="log is-hidden" id="chunkLog"></div>
    </section>

    <section class="panel" id="usageSection">
      <div class="section-title">[4] 사용량</div>
      <div class="usage-summary">
        <div>요약 모델 사용량: <span id="summaryUsage">N/A</span> · 비용 <span id="summaryCost" class="usage-cost">N/A</span></div>
        <div>번역 모델 사용량: <span id="translateUsage">N/A</span> · 비용 <span id="translateCost" class="usage-cost">N/A</span></div>
        <div>총 비용: <span id="totalCost" class="usage-cost">N/A</span></div>
      </div>
    </section>
  </main>

  <script src="./app.js" defer></script>
</body>
</html>
